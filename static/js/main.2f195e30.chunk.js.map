{"version":3,"sources":["hooks/useApi.ts","gallery/util.ts","gallery/Gallery.tsx","components/GentleSpin.tsx","hooks/useFormBinding.ts","playground/babelMaster.ts","playground/styled.ts","playground/util.tsx","playground/Playground.tsx","hooks/useInterval.ts","hooks/useModel.ts","hooks/useTrigger.ts","AppRouter.tsx","serviceWorker.ts","index.tsx"],"names":["defaultParseData","response","data","useApi","method","urlPattern","parseData","useState","setResponse","loading","setLoading","request","useCallback","a","patch","pathParams","Object","create","trueUrl","replace","$0","$1","Axios","url","getData","handleImageError","e","el","currentTarget","parent","parentNode","removeChild","Gallery","history","useHistory","resp","split","filter","Boolean","map","v","reqIndex","loadingIndex","getIndex","useEffect","className","spinning","gutter","xs","sm","id","key","hoverable","cover","alt","src","onError","onClick","push","Meta","title","GentleSpin","props","_spinning","rest","_value","value","setValue","debouncedSetValue","useMemo","_","debounce","leading","trailing","useGentle","useFormBinding","_initial","_parseValue","defaultParseValue","r","target","initial","parseValue","controlled","onChange","worker","Worker","wrapCode","code","trim","babelTransform","Promise","resolve","reject","fullCode","onerror","console","error","Error","slice","onmessage","res","postMessage","MainRow","styled","Row","media","lessThan","MainCol","Col","MountNode","div","ErrorInfo","pre","displayError","err","mountNode","document","querySelector","ReactDOM","render","stack","loadJsForceUmd","name","deps","keys","k","join","JSON","stringify","appendJs","createElement","innerHTML","onload","window","appendChild","assign","useInterval","func","interval","setInterval","clearInterval","useModel","reducer","initialState","_actions","useReducer","state","dispatch","reduce","acc","action","type","moment","immer","axios","Antd","React","loadJs","loadCss","rel","href","appendCss","setRendering","noop","Playground","file","useParams","codeBinding","editor","respIndex","reqCode","respCode","loadingCode","preloading","defaults","preview","setPreview","compiling","setCompiling","rendering","previewLoading","options","_func","throttle","singleton","cancel","useTrigger","isGreaterThanMedium","useMedia","minWidth","style","flex","overflowX","border","maxWidth","width","minHeight","maxHeight","height","mode","theme","lineNumbers","onBeforeChange","AppRouter","path","exact","component","to","location","hostname","match","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.2f195e30.chunk.js","sourcesContent":["import Axios, { AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { useCallback, useState } from 'react';\n\ninterface PathParams {\n  [key: string]: string;\n}\n\ntype Request = (\n  patch?: Partial<\n    AxiosRequestConfig & {\n      pathParams?: PathParams;\n    }\n  >\n) => Promise<void>;\n\nexport interface UseApiObj<T = any, DT = T | null> {\n  request: Request;\n  response: AxiosResponse<T> | null;\n  getData: () => DT;\n  loading: boolean;\n}\n\n// @todo useMemo config / default\n// @todo loading, error\n\nlet defaultParseData = (response: AxiosResponse | null) => {\n  return response ? response.data : null;\n};\n\nexport let useApi = <T = any, DT = T>(\n  method: AxiosRequestConfig['method'],\n  urlPattern: string,\n  parseData: (response: AxiosResponse<T> | null) => DT = defaultParseData\n): UseApiObj<T, DT> => {\n  let [response, setResponse] = useState<AxiosResponse<T> | null>(null);\n  let [loading, setLoading] = useState(false);\n\n  let request: Request = useCallback(\n    async (patch = {}) => {\n      let pathParams: PathParams = patch.pathParams || Object.create(null);\n\n      let trueUrl = urlPattern.replace(/\\/:([^/?#&\\d][^/?#&]*)/g, ($0, $1) => {\n        return `/${pathParams[$1]}`;\n      });\n\n      try {\n        setLoading(true);\n        let response = await Axios({\n          method,\n          url: trueUrl,\n          ...patch,\n        });\n        setResponse(response);\n      } catch (err) {\n        // @todo\n      } finally {\n        setLoading(false);\n      }\n    },\n    [method, setResponse, urlPattern]\n  );\n\n  let getData = useCallback(() => {\n    return parseData(response);\n  }, [parseData, response]);\n\n  return { request, response, getData, loading };\n};\n","export let handleImageError = (\n  e: React.SyntheticEvent<HTMLImageElement, Event>\n) => {\n  let el = e.currentTarget;\n  let parent = el.parentNode;\n  if (parent) parent.removeChild(el);\n};\n","import { Card, Col, Row, Spin } from 'antd';\nimport React, { useEffect } from 'react';\nimport { useHistory } from 'react-router';\nimport { useApi } from '../hooks/useApi';\nimport './page.css';\nimport { handleImageError } from './util';\nimport Helmet from 'react-helmet';\n\nexport let Gallery: React.FC = () => {\n  let history = useHistory();\n\n  let { request: reqIndex, loading: loadingIndex, getData: getIndex } = useApi<\n    string,\n    string[]\n  >('GET', 'code/index.yml', resp => {\n    if (!resp) return [];\n    let txt = resp.data;\n    let list = txt\n      .split(/\\n/)\n      .filter(Boolean)\n      .map(v => v.replace(/^-\\s*/, ''));\n    return list;\n  });\n\n  useEffect(() => {\n    reqIndex();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  return (\n    <div className=\"page-gallery\">\n      <Helmet>\n        <title>Gallery</title>\n      </Helmet>\n      <Spin spinning={loadingIndex}>\n        <div className=\"main-container\">\n          <Row\n            gutter={[\n              { xs: 12, sm: 16 },\n              { xs: 12, sm: 16 },\n            ]}\n          >\n            {getIndex().map(id => {\n              return (\n                <Col key={id} xs={12} sm={12}>\n                  <Card\n                    hoverable\n                    cover={\n                      <img\n                        alt=\"\"\n                        src={`code/${id}.png`}\n                        onError={handleImageError}\n                      />\n                    }\n                    onClick={() => {\n                      history.push(`/playground/${id}`);\n                    }}\n                  >\n                    <Card.Meta\n                      title={id}\n                      // description=\"www.instagram.com\"\n                    />\n                  </Card>\n                </Col>\n              );\n            })}\n          </Row>\n        </div>\n      </Spin>\n    </div>\n  );\n};\n","import { Spin } from 'antd';\nimport { SpinProps } from 'antd/lib/spin';\nimport _ from 'lodash';\nimport React, { useEffect, useMemo, useState } from 'react';\n\ntype UseGentle = <T = any>(v: T) => T;\n\nlet useGentle: UseGentle = _value => {\n  let [value, setValue] = useState(_value);\n\n  let debouncedSetValue = useMemo(() => {\n    return _.debounce(setValue, 1000, {\n      leading: true,\n      trailing: true,\n    });\n  }, []);\n\n  useEffect(() => {\n    if (_value) {\n      setValue(_value);\n    } else {\n      debouncedSetValue(_value);\n    }\n  }, [_value, debouncedSetValue]);\n\n  return value;\n};\n\nexport let GentleSpin: React.FC<SpinProps> = props => {\n  let { spinning: _spinning, ...rest } = props;\n\n  let spinning = useGentle(_spinning); // todo\n\n  return <Spin {...{ ...rest, spinning }} />;\n};\n","import { useCallback, useMemo, useState } from 'react';\n\ntype ParseValue<T> = (...args: any[]) => T;\n\n// @todo uncontrolled / defaultValue\n\nexport let useFormBinding = <T>(_initial: T, _parseValue?: ParseValue<T>) => {\n  let defaultParseValue: ParseValue<T> = useCallback(e => {\n    let r = e;\n    if (e && e.target && 'value' in e.target) {\n      r = e.target.value;\n    }\n    return r;\n  }, []);\n\n  let [initial, parseValue] = useMemo(() => {\n    return [_initial, _parseValue || defaultParseValue];\n  }, [_initial, _parseValue, defaultParseValue]);\n\n  let [value, setValue] = useState<T>(initial);\n\n  let handleChange = useCallback(\n    (e, ...rest) => {\n      let r = parseValue(e, ...rest);\n      setValue(r);\n    },\n    [parseValue]\n  );\n\n  let controlled = {\n    value,\n    onChange: handleChange,\n  };\n\n  return { value, controlled };\n};\n","let worker = new Worker('./babel-worker.js');\n\nlet wrapCode = (code: string) => {\n  return `\n(async () => {\n  setRendering(true)\n  mountNode.innerHTML = ''\n  try {\n    let { useRef, useMemo, useState, useEffect, useLayoutEffect, useReducer, useContext, useCallback, useImperativeHandle } = React\n    ;;${code};;\n\n    let isVueLike = _.isPlainObject(App)\n    if (isVueLike) {\n      if (!mountNode.children[0]) {\n        let innerNode = document.createElement('div')\n        mountNode.appendChild(innerNode)\n      }\n      let curr = mountNode.children[0]\n      new Vue(App).$mount(curr)\n    } else {\n      ReactDOM.render(<App />, mountNode)\n    }\n  } catch (err) {\n    console.error(['displayError', err])\n    displayError(err)\n  } finally {\n    setRendering(false)\n  }\n})()\n  `.trim();\n};\n\nexport let babelTransform = async (code: string): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    let fullCode = wrapCode(code);\n\n    worker.onerror = e => {\n      console.error(['worker onerror', e]);\n      reject(new Error(`worker onerror - ${code.slice(0, 100)}`));\n    };\n\n    worker.onmessage = e => {\n      let res = e.data;\n      if (res.error) {\n        reject(res.error as Error);\n      } else {\n        resolve(res.data as string);\n      }\n    };\n    worker.postMessage(fullCode);\n  });\n};\n","import { Col, Row } from 'antd';\nimport styled from 'styled-components';\nimport media from 'styled-media-query';\n\n/**\n * https://github.com/morajabi/styled-media-query\n * export const defaultBreakpoints = {\n    huge: '1440px',\n    large: '1170px',\n    medium: '768px',\n    small: '450px',\n  };\n */\n\nexport let MainRow = styled(Row)`\n  height: 100%;\n  display: flex;\n\n  ${media.lessThan('medium')`\n    flex-direction: column;\n  `}\n`;\n\nexport let MainCol = styled(Col)`\n  height: 100%;\n`;\n\nexport let MountNode = styled.div`\n  height: 100%;\n`;\n\nexport let ErrorInfo = styled.pre`\n  font-size: 12px;\n  color: red;\n  white-space: pre-wrap;\n  padding: 10px;\n`;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ErrorInfo } from './styled';\nimport Axios from 'axios';\n\nexport let displayError = (err: Error) => {\n  let mountNode = document.querySelector('#mountNode');\n  ReactDOM.render(<ErrorInfo>{err.stack}</ErrorInfo>, mountNode);\n};\n\nexport let loadJsForceUmd = async ({\n  url,\n  name,\n  deps = {},\n}: {\n  url: string;\n  name: string;\n  deps: { [key: string]: string };\n}) => {\n  let { data: code } = await Axios(url);\n  code = `\n    (() => {\n      let module = { exports: {} }\n      let require = k => {\n        ${Object.keys(deps)\n          .map(k => `if (k === ${k}) return ${deps[k]}`)\n          .join('\\n')}\n        throw new Error(\\`module '\\${k}' not found\\`)\n      }\n      ;;${code};;\n      window[${JSON.stringify(name)}] = module.exports\n    })()\n  `;\n  appendJs(code);\n};\n\nexport let loadJs = (url: string) => {\n  return new Promise((resolve, reject) => {\n    let el = document.createElement('script');\n    el.src = url;\n    el.onload = () => {\n      resolve();\n    };\n    el.onerror = e => {\n      reject(new Error(`loadJs onerror - ${url}`));\n    };\n    window.mountNode.appendChild(el);\n  });\n};\n\nexport let loadCss = (url: string) => {\n  return new Promise((resolve, reject) => {\n    let el = document.createElement('link');\n    el.rel = 'stylesheet';\n    el.href = url;\n    el.onload = () => {\n      resolve();\n    };\n    el.onerror = e => {\n      reject(new Error(`loadCss onerror - ${url}`));\n    };\n    window.mountNode.appendChild(el);\n  });\n};\n\nexport let appendJs = (code: string) => {\n  return new Promise((resolve, reject) => {\n    let el = document.createElement('script');\n    el.innerHTML = code;\n    el.onload = () => {\n      resolve();\n    };\n    el.onerror = e => {\n      reject(new Error(`appendJs onerror - ${code.slice(0, 100)}`));\n    };\n    window.mountNode.appendChild(el);\n  });\n};\n\nexport let appendCss = (code: string) => {\n  return new Promise((resolve, reject) => {\n    let el = document.createElement('style');\n    el.innerHTML = code;\n    el.onload = () => {\n      resolve();\n    };\n    el.onerror = e => {\n      reject(new Error(`appendCss onerror - ${code.slice(0, 100)}`));\n    };\n    window.mountNode.appendChild(el);\n  });\n};\n","import * as Antd from 'antd';\nimport 'codemirror/lib/codemirror.css';\n// import 'codemirror/mode/javascript/javascript';\nimport 'codemirror/mode/jsx/jsx';\nimport 'codemirror/theme/material.css';\nimport _ from 'lodash';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { Controlled as CodeMirror } from 'react-codemirror2';\nimport ReactDOM from 'react-dom';\nimport { DragSizing } from 'react-drag-sizing';\nimport Helmet from 'react-helmet';\nimport { useHistory, useParams } from 'react-router';\nimport styled from 'styled-components';\nimport useMedia from 'use-media';\nimport immer from 'immer';\nimport Axios from 'axios';\nimport moment from 'moment';\nimport { GentleSpin } from '../components/GentleSpin';\nimport { useApi } from '../hooks/useApi';\nimport { useFormBinding } from '../hooks/useFormBinding';\nimport { useInterval } from '../hooks/useInterval';\nimport { useModel } from '../hooks/useModel';\nimport { useTrigger } from '../hooks/useTrigger';\nimport { babelTransform } from './babelMaster';\nimport './page.css';\nimport { MainCol, MainRow, MountNode } from './styled';\nimport {\n  displayError,\n  loadJsForceUmd,\n  loadJs,\n  loadCss,\n  appendJs,\n  appendCss,\n} from './util';\n\nObject.assign(window, {\n  useFormBinding,\n  useInterval,\n  useModel,\n  moment,\n  styled,\n  immer,\n  _,\n  axios: Axios,\n  Antd,\n  React,\n  ReactDOM,\n  displayError,\n  loadJsForceUmd,\n  loadJs,\n  loadCss,\n  appendJs,\n  appendCss,\n  setRendering: _.noop, // noop placeholder\n});\n\n// let storeKeyCode = 'playground__initialCode';\n\nexport let Playground: React.FC = () => {\n  let history = useHistory();\n  let { file } = useParams() as { file: string };\n  // let initialCode = useMemo(() => {\n  //   return localStorage.getItem(storeKeyCode) || _initialCode;\n  // }, []);\n  let initialCode = '';\n  let codeBinding = useFormBinding(initialCode, (editor, data, value) => value);\n\n  let {\n    request: reqIndex,\n    response: respIndex,\n    loading: loadingIndex,\n  } = useApi<string>('GET', 'code/index.yml');\n  let { request: reqCode, response: respCode, loading: loadingCode } = useApi<\n    string\n  >('GET', 'code/:file');\n  let preloading = loadingIndex || loadingCode;\n\n  useEffect(() => {\n    if (file) {\n      reqCode({ pathParams: { file } });\n    } else {\n      reqIndex();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [file]);\n\n  useEffect(() => {\n    if (respIndex == null) return;\n    let txt = respIndex.data;\n    let list = txt\n      .split(/\\n/)\n      .filter(Boolean)\n      .map(v => v.replace(/^-\\s*/, ''));\n    let defaults = list[0];\n    // reqCode({ pathParams: { file: file || defaults } });\n    history.push(`/playground/${file || defaults}`);\n  }, [file, history, reqCode, respIndex]);\n\n  useEffect(() => {\n    if (respCode == null) return;\n    codeBinding.controlled.onChange(null, null, respCode.data);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [respCode]);\n\n  let [preview, setPreview] = useState('');\n  let [compiling, setCompiling] = useState(false);\n  let [rendering, setRendering] = useState(false);\n  let previewLoading = preloading || compiling || rendering;\n\n  Object.assign(window, { setRendering }); // without side-effect\n\n  let doPreview = useCallback(async (code: string) => {\n    if (!code) return;\n    setCompiling(true);\n    try {\n      let res = await babelTransform(code);\n      setPreview(res);\n    } catch (err) {\n      displayError(err);\n    } finally {\n      setCompiling(false);\n    }\n  }, []);\n\n  // let persistEditor = useCallback((code: string) => {\n  //   localStorage.setItem(storeKeyCode, code);\n  // }, []);\n\n  useTrigger(\n    {\n      debounce: 1000,\n      // initial: true,\n      cancel: true,\n      singleton: true,\n    },\n    doPreview,\n    [codeBinding.value]\n  );\n\n  // useTrigger(\n  //   {\n  //     throttle: 1000,\n  //   },\n  //   persistEditor,\n  //   [codeBinding.value]\n  // );\n\n  // keeping sync'd with styled.ts (medium=768px)\n  let isGreaterThanMedium = useMedia({ minWidth: '768px' });\n\n  return (\n    <div className=\"page-playground\">\n      <Helmet>\n        <title>Playground</title>\n        <style>{`html { overflow: hidden } #root { height: 100% }`}</style>\n        <script>{preview}</script>\n      </Helmet>\n      <MainRow>\n        <MainCol style={{ flex: 1, overflowX: 'auto' }}>\n          <GentleSpin spinning={previewLoading}>\n            <MountNode id=\"mountNode\" />\n          </GentleSpin>\n        </MainCol>\n        <DragSizing\n          {...(isGreaterThanMedium\n            ? {\n                border: 'left',\n                style: {\n                  minWidth: '20%',\n                  maxWidth: '80%',\n                  width: '50%',\n                },\n              }\n            : {\n                border: 'top',\n                style: {\n                  minHeight: '20%',\n                  maxHeight: '80%',\n                  height: '50%',\n                },\n              })}\n        >\n          <MainCol>\n            <CodeMirror\n              className=\"main-editor\"\n              options={{\n                mode: 'text/typescript-jsx',\n                theme: 'material',\n                lineNumbers: true,\n              }}\n              value={codeBinding.controlled.value}\n              onBeforeChange={codeBinding.controlled.onChange}\n            />\n          </MainCol>\n        </DragSizing>\n      </MainRow>\n    </div>\n  );\n};\n","import { useEffect } from 'react';\n\ntype AnyFunc = (...args: any) => any;\n\nexport let useInterval = (func: AnyFunc, interval: number) => {\n  useEffect(() => {\n    let id = setInterval(() => {\n      func();\n    }, interval);\n    return () => {\n      if (id) clearInterval(id);\n    };\n  }, [func, interval]);\n};\n","import _ from 'lodash';\nimport { Reducer, useMemo, useReducer } from 'react';\n\ninterface ActionArgMap<A> {\n  [type: string]: (...args: any[]) => Omit<A, 'type'> | null;\n}\ninterface ActionMap<A> {\n  [type: string]: (...args: any[]) => A;\n}\n\nexport let useModel = <S, A extends { type: string }>(\n  reducer: Reducer<S, A>,\n  initialState: S,\n  _actions: ActionArgMap<A>\n) => {\n  let [state, dispatch] = useReducer<Reducer<S, A>>(reducer, initialState);\n\n  let actions = useMemo<ActionMap<A>>(() => {\n    return _.reduce(\n      _actions,\n      (acc, func, k) => {\n        acc[k] = (...args: any[]) => {\n          let patch = func(...args);\n          let action = { type: k, ...patch } as A;\n          return dispatch(action);\n        };\n        return acc;\n      },\n      Object.create(null)\n    );\n  }, [_actions, dispatch]);\n\n  return [state, actions];\n};\n","import _ from 'lodash';\nimport { useEffect, useMemo } from 'react';\n\ntype AnyFunc = (...args: any) => any;\n\ninterface Options {\n  debounce?: number;\n  throttle?: number;\n  options?: _.DebounceSettings | _.ThrottleSettings;\n  initial?: boolean;\n  cancel?: boolean;\n  singleton?: boolean;\n}\n\nexport let useTrigger = (options: Options, _func: AnyFunc, deps: any[]) => {\n  options = options || {};\n\n  let func: AnyFunc | (AnyFunc & _.Cancelable) = useMemo(() => {\n    if (options.debounce) {\n      return _.debounce(_func, options.debounce, options.options);\n    } else if (options.throttle) {\n      return _.throttle(_func, options.throttle, options.options);\n    } else {\n      return _func;\n    }\n  }, [_func, options.debounce, options.options, options.throttle]);\n\n  useEffect(() => {\n    if (options.singleton) {\n      if ('cancel' in func) func.cancel();\n    }\n    func(...deps);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps);\n\n  useEffect(() => {\n    if (options.initial) {\n      if ('cancel' in func) func.cancel();\n      _func(...deps);\n    }\n    return () => {\n      if (options.cancel) {\n        if ('cancel' in func) func.cancel();\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};\n","import React from 'react';\nimport {\n  HashRouter as Router,\n  Route,\n  Switch,\n  Redirect,\n} from 'react-router-dom';\nimport { Gallery } from './gallery';\nimport { Playground } from './playground';\n\nfunction AppRouter() {\n  return (\n    <Router>\n      <Switch>\n        <Route path=\"/\" exact component={Gallery} />\n        <Route path=\"/playground/:file\" component={Playground} />\n        <Route path=\"*\">\n          <Redirect to=\"/\" />\n        </Route>\n      </Switch>\n    </Router>\n  );\n}\n\nexport default AppRouter;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport AppRouter from './AppRouter';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<AppRouter />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}