{"version":3,"sources":["hooks/useApi.ts","components/GentleSpin.tsx","hooks/useFormBinding.ts","playground/babelMaster.ts","playground/codeTransform.ts","playground/styled.ts","playground/util.tsx","playground/Playground.tsx","hooks/useInterval.ts","hooks/useModel.ts","hooks/useTrigger.ts"],"names":["defaultParseData","response","data","useApi","method","urlPattern","parseData","useState","setResponse","loading","setLoading","error","setError","request","useCallback","a","patch","pathParams","Object","create","trueUrl","replace","$0","$1","Axios","url","getData","GentleSpin","props","_spinning","spinning","rest","_value","value","setValue","debouncedSetValue","useMemo","_","debounce","leading","trailing","useEffect","cancel","useGentle","useFormBinding","_initial","_parseValue","defaultParseValue","e","r","target","initial","parseValue","controlled","onChange","worker","Worker","babelTransform","code","file","Promise","resolve","reject","onerror","console","Error","slice","onmessage","res","postMessage","codeTransform","isMd","endsWith","isPy","isVue","wrapMd","wrapPy","wrapVue","wrapJs","hasJsx","some","ext","hasTs","sandbox","document","createElement","innerHTML","vueTemplateEl","querySelector","vueTemplate","vueScript","querySelectorAll","forEach","el","vueStyle","JSON","stringify","trim","MainRow","styled","Row","media","lessThan","MainCol","Col","MountNode","div","ErrorInfo","pre","displayError","err","mountNode","ReactDOM","render","stack","loadJsForceUmd","name","deps","message","keys","map","k","join","appendJs","window","assetsNode","appendChild","assign","useInterval","func","interval","id","setInterval","clearInterval","useModel","reducer","initialState","_actions","useReducer","state","dispatch","reduce","acc","action","type","moment","immer","axios","Antd","React","loadJs","Array","isArray","all","then","src","onload","loadCss","rel","href","appendCss","appendHtml","setRendering","noop","Playground","history","useHistory","useParams","codeBinding","editor","reqCode","errReqCode","respCode","loadingCode","push","preview","setPreview","compiling","setCompiling","rendering","_setRendering","previewLoading","addLoading","s","doPreview","options","_func","throttle","singleton","useTrigger","triggerPreview","Date","isGreaterThanMedium","useMedia","minWidth","handleSizingUpdate","event","Event","dispatchEvent","addEventListener","removeEventListener","className","style","flex","overflowX","onUpdate","border","maxWidth","width","minHeight","maxHeight","height","mode","theme","lineNumbers","onBeforeChange"],"mappings":"4NA0BIA,EAAmB,SAACC,GACtB,OAAOA,EAAWA,EAASC,KAAO,MAGzBC,EAAS,SAClBC,EACAC,GAEsB,IADtBC,EACqB,uDADkCN,EAClC,EACSO,mBAAkC,MAD3C,mBAChBN,EADgB,KACNO,EADM,OAEOD,oBAAS,GAFhB,mBAEhBE,EAFgB,KAEPC,EAFO,OAGGH,mBAAS,MAHZ,mBAGhBI,EAHgB,KAGTC,EAHS,KAKjBC,EAAmBC,sBAAW,sBAChC,8CAAAC,EAAA,6DAAOC,EAAP,+BAAe,GACTC,EAAyBD,EAAMC,YAAcC,OAAOC,OAAO,MAE3DC,EAAUf,EAAWgB,QAAQ,2BAA2B,SAACC,EAAIC,GAC/D,MAAM,IAAN,OAAWN,EAAWM,OAJ1B,SAQIb,GAAW,GARf,SASyBc,IAAM,aACzBpB,SACAqB,IAAKL,GACFJ,IAZT,OASQf,EATR,OAcIO,EAAYP,GACZW,EAAS,MAfb,kDAiBIJ,EAAY,MACZI,EAAS,EAAD,IAlBZ,yBAoBIF,GAAW,GApBf,6EAuBA,CAACN,EAAQI,EAAaH,IAGpBqB,EAAUZ,uBAAY,WACxB,OAAOR,EAAUL,KAChB,CAACK,EAAWL,IAEf,MAAO,CAAEY,UAASF,QAAOV,WAAUyB,UAASjB,a,mbCvCnCkB,EAAkC,SAAAC,GAAU,IACrCC,EAAuBD,EAAjCE,SAAwBC,EADsB,YACbH,EADa,cAGhDE,EA3BqB,SAAAE,GAAW,IAAD,EACXzB,mBAASyB,GADE,mBAC9BC,EAD8B,KACvBC,EADuB,KAG/BC,EAAoBC,mBAAQ,WAC9B,OAAOC,IAAEC,SAASJ,EAAU,IAAM,CAChCK,SAAS,EACTC,UAAU,MAEX,IAaH,OAXAC,qBAAU,WAMR,OALIT,EACFE,EAASF,GAETG,EAAkBH,GAEb,WACLG,EAAkBO,YAEnB,CAACV,EAAQG,IAELF,EAMQU,CAAUd,GAEzB,OAAO,kBAAC,IAAD,2BAAeE,GAAf,IAAqBD,e,SC9BnBc,EAAiB,SAAIC,EAAaC,GAC3C,IAAIC,EAAmCjC,uBAAY,SAAAkC,GACjD,IAAIC,EAAID,EAIR,OAHIA,GAAKA,EAAEE,QAAU,UAAWF,EAAEE,SAChCD,EAAID,EAAEE,OAAOjB,OAERgB,IACN,IAPwE,EAS/Cb,mBAAQ,WAClC,MAAO,CAACS,EAAUC,GAAeC,KAChC,CAACF,EAAUC,EAAaC,IAXgD,mBAStEI,EATsE,KAS7DC,EAT6D,OAanD7C,mBAAY4C,GAbuC,mBAatElB,EAbsE,KAa/DC,EAb+D,KA4B3E,MAAO,CAAED,QAAOoB,WALC,CACfpB,QACAqB,SAViBxC,uBACjB,SAACkC,GAAgB,IAAD,uBAATjB,EAAS,iCAATA,EAAS,kBACd,IAAIkB,EAAIG,EAAU,WAAV,GAAWJ,GAAX,OAAiBjB,IACzBG,EAASe,KAEX,CAACG,O,SC1BDG,EAAS,IAAIC,OAAO,qBAEbC,EAAc,uCAAG,WAC1BC,EACAC,GAF0B,SAAA5C,EAAA,+EAInB,IAAI6C,SAAQ,SAACC,EAASC,GAC3BP,EAAOQ,QAAU,SAAAf,GACfgB,QAAQrD,MAAM,CAAC,iBAAkBqC,IACjCc,EAAO,IAAIG,MAAJ,2BAA8BP,EAAKQ,MAAM,EAAG,SAGrDX,EAAOY,UAAY,SAAAnB,GACjB,IAAIoB,EAAMpB,EAAE9C,KACRkE,EAAIzD,MACNmD,EAAOM,EAAIzD,OAEXkD,EAAQO,EAAIlE,OAGhBqD,EAAOc,YAAY,CAAEX,OAAMC,aAlBH,2CAAH,wDCAdW,EAAa,uCAAG,WAAOZ,EAAcC,GAArB,uBAAA5C,EAAA,yDACrBwD,EAAOZ,EAAKa,SAAS,OACrBC,EAAOd,EAAKa,SAAS,OACrBE,EAAQf,EAAKa,SAAS,SACtBD,EAJqB,yCAIRI,EAAOjB,IAJC,WAKrBe,EALqB,yCAKRG,EAAOlB,IALC,WAMrBgB,EANqB,yCAMPG,EAAQnB,IAND,UAQzBA,EAAOoB,EAAOpB,GACVqB,EAASpB,GAAQ,CAAC,OAAQ,QAAQqB,MAAK,SAAAC,GAAG,OAAItB,EAAKa,SAASS,MAC5DC,EAAQvB,GAAQ,CAAC,MAAO,QAAQqB,MAAK,SAAAC,GAAG,OAAItB,EAAKa,SAASS,OAC1DF,IAAUG,EAXW,kCAWSzB,EAAeC,EAAMC,GAX9B,QAWJD,EAXI,wCAYlBA,GAZkB,4CAAH,wDAebmB,EAAU,SAACnB,GAEpB,IAAIyB,EAAUC,SAASC,cAAc,OACrCF,EAAQG,UAAY5B,EAEpB,IAAI6B,EAAgBJ,EAAQK,cAAc,YACtCC,EAAcF,EAAgBA,EAAcD,UAAY,GACxDI,EAAY,GAChBP,EAAQQ,iBAAiB,UAAUC,SAAQ,SAAAC,GACzCH,GAAaG,EAAGP,UAAY,YAE9B,IAAIQ,EAAW,GAKf,OAJAX,EAAQQ,iBAAiB,SAASC,SAAQ,SAAAC,GACxCC,GAAYD,EAAGP,UAAY,UAGtB,ucAgBOS,KAAKC,UAAUF,GAhBtB,2EAoBCJ,EApBD,0EAuBYK,KAAKC,UAAUP,GAvB3B,+aA0CLQ,QAGOtB,EAAS,SAACjB,GACnB,MAAO,+8BAgC6BqC,KAAKC,UAAUtC,GAhC5C,wlCAqELuC,QAGOrB,EAAS,SAAClB,GACnB,MAAO,ymCAoCUqC,KAAKC,UAAUtC,GApCzB,86BAoELuC,QAGOnB,EAAS,SAACpB,GACnB,MAAO,ogBAiBDA,EAjBC,kpBA2CLuC,Q,ypBC7PG,IAAIC,EAAUC,YAAOC,IAAPD,CAAH,IAIdE,IAAMC,SAAS,SAAfD,CAJc,MASPE,EAAUJ,YAAOK,IAAPL,CAAH,KAIPM,EAAYN,IAAOO,IAAV,KAOTC,EAAYR,IAAOS,IAAV,KC7BTC,GAAe,SAACC,GACzB,IAAIC,EAAY3B,SAASI,cAAc,cACvCwB,IAASC,OAAO,kBAACN,EAAD,KAAYG,EAAII,OAAoBH,IAG3CI,GAAc,uCAAG,yCAAApG,EAAA,6DAC1BU,EAD0B,EAC1BA,IACA2F,EAF0B,EAE1BA,KAF0B,IAG1BC,YAH0B,MAGnB,GAHmB,EAStB3D,EAAO,GATe,kBAWHlC,IAAMC,GAXH,gBAWlBvB,EAXkB,EAWlBA,KACNwD,EAAOxD,EAZiB,wDAclB,IAAI+D,MAAJ,2BAA8B,KAAIqD,QAAlC,cAA+C7F,IAd7B,QAgB1BiC,EAAI,kGAIIxC,OAAOqG,KAAKF,GACXG,KAAI,SAAAC,GAAC,0BAAiB1B,KAAKC,UAAUyB,GAAhC,oBAA8CJ,EAAKI,OACxDC,KAAK,MANV,kFASIhE,EATJ,4BAUSqC,KAAKC,UAAUoB,GAVxB,oCAaJO,GAASjE,GA7BiB,0DAAH,sDAoEdiE,GAAW,SAACjE,GACrB,IAAImC,EAAKT,SAASC,cAAc,UAChCQ,EAAGP,UAAY5B,EACfkE,OAAOC,WAAWC,YAAYjC,ICzChC3E,OAAO6G,OAAOH,OAAQ,CACpBhF,iBACAoF,YCtCuB,SAACC,EAAeC,GACvCzF,qBAAU,WACR,IAAI0F,EAAKC,aAAY,WACnBH,MACCC,GACH,OAAO,WACDC,GAAIE,cAAcF,MAEvB,CAACF,EAAMC,KD+BVI,SEjCoB,SACpBC,EACAC,EACAC,GACI,IAAD,EACqBC,qBAA0BH,EAASC,GADxD,mBACEG,EADF,KACSC,EADT,KAkBH,MAAO,CAACD,EAfMvG,mBAAsB,WAClC,OAAOC,IAAEwG,OACPJ,GACA,SAACK,EAAKb,EAAMR,GAMV,OALAqB,EAAIrB,GAAK,WACP,IAAIzG,EAAQiH,EAAI,WAAJ,aACRc,EAAM,aAAKC,KAAMvB,GAAMzG,GAC3B,OAAO4H,EAASG,IAEXD,IAET5H,OAAOC,OAAO,SAEf,CAACsH,EAAUG,MFcdK,WACA9C,WACA+C,UACA7G,MACA8G,MAAO3H,IACP4H,OACAC,UACArC,aACAH,gBACAM,kBACAmC,ODZkB,SAATA,EAAU7H,GACnB,OAAI8H,MAAMC,QAAQ/H,GACTmC,QAAQ6F,IAAIhI,EAAI+F,IAAI8B,IAASI,MAAK,eAEpC,IAAI9F,SAAQ,SAACC,EAASC,GAC3B,IAAI+B,EAAKT,SAASC,cAAc,UAChCQ,EAAG8D,IAAMlI,EACToE,EAAG+D,OAAS,WACV/F,KAEFgC,EAAG9B,QAAU,SAAAf,GACXc,EAAO,IAAIG,MAAJ,2BAA8BxC,MAEvCmG,OAAOC,WAAWC,YAAYjC,OCAhCgE,QDImB,SAAVA,EAAWpI,GACpB,OAAI8H,MAAMC,QAAQ/H,GACTmC,QAAQ6F,IAAIhI,EAAI+F,IAAIqC,IAAUH,MAAK,eAErC,IAAI9F,SAAQ,SAACC,EAASC,GAC3B,IAAI+B,EAAKT,SAASC,cAAc,QAChCQ,EAAGiE,IAAM,aACTjE,EAAGkE,KAAOtI,EACVoE,EAAG+D,OAAS,WACV/F,KAEFgC,EAAG9B,QAAU,SAAAf,GACXc,EAAO,IAAIG,MAAJ,4BAA+BxC,MAExCmG,OAAOC,WAAWC,YAAYjC,OCjBhC8B,YACAqC,UD2BqB,SAACtG,GACtB,IAAImC,EAAKT,SAASC,cAAc,SAChCQ,EAAGP,UAAY5B,EACfkE,OAAOC,WAAWC,YAAYjC,IC7B9BoE,WDgCsB,SAACvG,GACvBkE,OAAOb,UAAUzB,WAAa5B,GChC9BwG,aAAc7H,IAAE8H,OAKX,IAAIC,GAAuB,WAChC,IAAIC,EAAUC,cACR3G,EAAS4G,cAAT5G,KAGFe,GAFJf,EAAOA,GAAQ,IAEEa,SAAS,QACtBC,EAAOd,EAAKa,SAAS,OACrBD,EAAOZ,EAAKa,SAAS,OAMrBgG,EAAc5H,EADA,IAC4B,SAAC6H,EAAQvK,EAAM+B,GAAf,OAAyBA,KAbjC,EAoBlC9B,YAAe,MAAO,cAJfuK,EAhB2B,EAgBpC7J,QACO8J,EAjB6B,EAiBpChK,MACUiK,EAlB0B,EAkBpC3K,SACS4K,EAnB2B,EAmBpCpK,QAGFgC,qBAAU,WACJkB,EACF+G,EAAQ,CAAEzJ,WAAY,CAAE0C,UAExB0G,EAAQS,KAAK,OAGd,CAACnH,IAEJlB,qBAAU,WACQ,MAAZmI,GACJJ,EAAYnH,WAAWC,SAAS,KAAM,KAAMsH,EAAS1K,QAEpD,CAAC0K,IAEJnI,qBAAU,WAIJkI,GACF9D,GAAa,IAAI5C,MAAJ,UAAa0G,EAAWrD,QAAxB,cAAqC3D,OAGnD,CAACgH,IA7CkC,MA+CVpK,mBAAS,IA/CC,mBA+CjCwK,EA/CiC,KA+CxBC,EA/CwB,OAgDNzK,oBAAS,GAhDH,mBAgDjC0K,EAhDiC,KAgDtBC,EAhDsB,OAiDL3K,mBAAS,GAjDJ,mBAiDjC4K,EAjDiC,KAiDtBC,EAjDsB,KAkDlCC,EAAiBR,GAAeI,GAAaE,EAAY,EAEzDG,EAAaxK,uBAAY,WAE3B,OADAsK,GAAc,SAAAG,GAAC,OAAIA,EAAI,KAChB,kBAAMH,GAAc,SAAAG,GAAC,OAAIA,EAAI,QACnC,IAEHrK,OAAO6G,OAAOH,OAAQ,CAAE0D,eAExB,IAAIE,EAAY1K,sBAAW,uCACzB,WAAO4C,GAAP,eAAA3C,EAAA,yDACO2C,EADP,wDAEEwH,GAAa,GAFf,kBAIoB5G,EAAcZ,EAAMC,GAJxC,OAIQS,EAJR,OAMI4G,EAAW5G,GANf,kDAQIyC,GAAa,EAAD,IARhB,yBAUIqE,GAAa,GAVjB,6EADyB,sDAczB,CAACvH,KG3HmB,SAAC8H,EAAkBC,EAAgBrE,GACzDoE,EAAUA,GAAW,GAErB,IAAIxD,EAA2C7F,mBAAQ,WACrD,OAAIqJ,EAAQnJ,SACHD,IAAEC,SAASoJ,EAAOD,EAAQnJ,SAAUmJ,EAAQA,SAC1CA,EAAQE,SACVtJ,IAAEsJ,SAASD,EAAOD,EAAQE,SAAUF,EAAQA,SAE5CC,IAER,CAACA,EAAOD,EAAQnJ,SAAUmJ,EAAQA,QAASA,EAAQE,WAEtDlJ,qBAAU,WACJgJ,EAAQG,WACN,WAAY3D,GAAMA,EAAKvF,SAE7BuF,EAAI,WAAJ,cAAQZ,MAEPA,GAEH5E,qBAAU,WAKR,OAJIgJ,EAAQtI,UACN,WAAY8E,GAAMA,EAAKvF,SAC3BgJ,EAAK,WAAL,cAASrE,KAEJ,WACDoE,EAAQ/I,QACN,WAAYuF,GAAMA,EAAKvF,YAI9B,IHkGHmJ,CACE,CACEvJ,SAAU,IAEVI,QAAQ,EACRkJ,WAAW,GAEbJ,EACA,CAAChB,EAAYvI,QAEf2F,OAAOkE,eAAiB,WAEtBN,EAAUhB,EAAYvI,MAAZ,iBAA8B,IAAI8J,KAAlC,SAYZ,IAAIC,EAAsBC,IAAS,CAAEC,SAAU,UAE3CC,EAAqBrL,uBAAY,WACnC,IAAIsL,EAAQ,IAAIC,MAAM,UACtBzE,OAAOb,UAAUuF,cAAcF,KAC9B,IASH,OAPA3J,qBAAU,WAER,OADAmF,OAAO2E,iBAAiB,SAAUJ,GAC3B,WACLvE,OAAO4E,oBAAoB,SAAUL,MAEtC,CAACA,IAGF,yBAAKM,UAAU,mBACb,kBAAC,IAAD,KACE,4CAAkB9I,EAAI,aAASA,GAAS,IACxC,mFACA,gCAASoH,IAEX,kBAAC7E,EAAD,KACE,kBAACK,EAAD,CAASmG,MAAO,CAAEC,KAAM,EAAGC,UAAW,SACpC,kBAAC,EAAD,CAAY9K,SAAUuJ,GACpB,kBAAC5E,EAAD,CAAW0B,GAAG,cACd,yBAAKA,GAAG,iBAGZ,kBAAC,IAAD,eACEsE,UAAU,cACVI,SAAUV,GACLH,EACD,CACEc,OAAQ,OACRJ,MAAO,CACLR,SAAU,MACVa,SAAU,MACVC,MAAO,QAGX,CACEF,OAAQ,MACRJ,MAAO,CACLO,UAAW,MACXC,UAAW,MACXC,OAAQ,SAIhB,kBAAC5G,EAAD,KACE,kBAAC,aAAD,CACEkG,UAAU,cACVhB,QAAS,CACP2B,KAAM7I,EACF,WACAG,EACA,MACAD,EACA,SACA,sBACJ4I,MAAO,WACPC,aAAa,GAEfrL,MAAOuI,EAAYnH,WAAWpB,MAC9BsL,eAAgB/C,EAAYnH,WAAWC","file":"static/js/5.829c0a39.chunk.js","sourcesContent":["import Axios, { AxiosRequestConfig, AxiosResponse } from 'axios';\nimport { useCallback, useState } from 'react';\n\ninterface PathParams {\n  [key: string]: string;\n}\n\ntype Request = (\n  patch?: Partial<\n    AxiosRequestConfig & {\n      pathParams?: PathParams;\n    }\n  >\n) => Promise<void>;\n\nexport interface UseApiObj<T = any, DT = T | null> {\n  request: Request;\n  error: Error | null;\n  response: AxiosResponse<T> | null;\n  getData: () => DT;\n  loading: boolean;\n}\n\n// @todo useMemo config / default\n// @todo loading, error\n\nlet defaultParseData = (response: AxiosResponse | null) => {\n  return response ? response.data : null;\n};\n\nexport let useApi = <T = any, DT = T>(\n  method: AxiosRequestConfig['method'],\n  urlPattern: string,\n  parseData: (response: AxiosResponse<T> | null) => DT = defaultParseData\n): UseApiObj<T, DT> => {\n  let [response, setResponse] = useState<AxiosResponse<T> | null>(null);\n  let [loading, setLoading] = useState(false);\n  let [error, setError] = useState(null);\n\n  let request: Request = useCallback(\n    async (patch = {}) => {\n      let pathParams: PathParams = patch.pathParams || Object.create(null);\n\n      let trueUrl = urlPattern.replace(/\\/:([^/?#&\\d][^/?#&]*)/g, ($0, $1) => {\n        return `/${pathParams[$1]}`;\n      });\n\n      try {\n        setLoading(true);\n        let response = await Axios({\n          method,\n          url: trueUrl,\n          ...patch,\n        });\n        setResponse(response);\n        setError(null);\n      } catch (err) {\n        setResponse(null);\n        setError(err);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [method, setResponse, urlPattern]\n  );\n\n  let getData = useCallback(() => {\n    return parseData(response);\n  }, [parseData, response]);\n\n  return { request, error, response, getData, loading };\n};\n","import { Spin } from 'antd';\nimport { SpinProps } from 'antd/lib/spin';\nimport _ from 'lodash';\nimport React, { useEffect, useMemo, useState } from 'react';\n\ntype UseGentle = <T = any>(v: T) => T;\n\nlet useGentle: UseGentle = _value => {\n  let [value, setValue] = useState(_value);\n\n  let debouncedSetValue = useMemo(() => {\n    return _.debounce(setValue, 1000, {\n      leading: true,\n      trailing: true,\n    });\n  }, []);\n\n  useEffect(() => {\n    if (_value) {\n      setValue(_value);\n    } else {\n      debouncedSetValue(_value);\n    }\n    return () => {\n      debouncedSetValue.cancel();\n    };\n  }, [_value, debouncedSetValue]);\n\n  return value;\n};\n\nexport let GentleSpin: React.FC<SpinProps> = props => {\n  let { spinning: _spinning, ...rest } = props;\n\n  let spinning = useGentle(_spinning); // todo\n\n  return <Spin {...{ ...rest, spinning }} />;\n};\n","import { useCallback, useMemo, useState } from 'react';\n\ntype ParseValue<T> = (...args: any[]) => T;\n\n// @todo uncontrolled / defaultValue\n\nexport let useFormBinding = <T>(_initial: T, _parseValue?: ParseValue<T>) => {\n  let defaultParseValue: ParseValue<T> = useCallback(e => {\n    let r = e;\n    if (e && e.target && 'value' in e.target) {\n      r = e.target.value;\n    }\n    return r;\n  }, []);\n\n  let [initial, parseValue] = useMemo(() => {\n    return [_initial, _parseValue || defaultParseValue];\n  }, [_initial, _parseValue, defaultParseValue]);\n\n  let [value, setValue] = useState<T>(initial);\n\n  let handleChange = useCallback(\n    (e, ...rest) => {\n      let r = parseValue(e, ...rest);\n      setValue(r);\n    },\n    [parseValue]\n  );\n\n  let controlled = {\n    value,\n    onChange: handleChange,\n  };\n\n  return { value, controlled };\n};\n","let worker = new Worker('./babel-worker.js');\n\nexport let babelTransform = async (\n  code: string,\n  file: string\n): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    worker.onerror = e => {\n      console.error(['worker onerror', e]);\n      reject(new Error(`worker onerror - ${code.slice(0, 100)}`));\n    };\n\n    worker.onmessage = e => {\n      let res = e.data;\n      if (res.error) {\n        reject(res.error as Error);\n      } else {\n        resolve(res.data as string);\n      }\n    };\n    worker.postMessage({ code, file });\n  });\n};\n","import { babelTransform } from './babelMaster';\n\nexport let codeTransform = async (code: string, file: string) => {\n  let isMd = file.endsWith('.md');\n  let isPy = file.endsWith('.py');\n  let isVue = file.endsWith('.vue');\n  if (isMd) return wrapMd(code);\n  if (isPy) return wrapPy(code);\n  if (isVue) return wrapVue(code);\n\n  code = wrapJs(code);\n  let hasJsx = file && ['.jsx', '.tsx'].some(ext => file.endsWith(ext));\n  let hasTs = file && ['.ts', '.tsx'].some(ext => file.endsWith(ext));\n  if (hasJsx || hasTs) code = await babelTransform(code, file);\n  return code;\n};\n\nexport let wrapVue = (code: string) => {\n  // todo move into rendering\n  let sandbox = document.createElement('div');\n  sandbox.innerHTML = code; // safe, script won't be executed\n\n  let vueTemplateEl = sandbox.querySelector('template');\n  let vueTemplate = vueTemplateEl ? vueTemplateEl.innerHTML : '';\n  let vueScript = '';\n  sandbox.querySelectorAll('script').forEach(el => {\n    vueScript += el.innerHTML + '\\n\\n;;';\n  });\n  let vueStyle = '';\n  sandbox.querySelectorAll('style').forEach(el => {\n    vueStyle += el.innerHTML + '\\n\\n';\n  });\n\n  return `\n(async () => {\n  let removeLoading = addLoading()\n  {\n    let a0 = assetsNode\n    a0.id = 'assetsNodeOutdated'\n    let a1 = document.createElement('div')\n    a1.id = 'assetsNode'\n    a0.parentNode.appendChild(a1)\n  }\n\n  ReactDOM.unmountComponentAtNode(mountNode)\n  mountNode.innerHTML = '' // put behind, otherwise can cause error in react\n\n  try {\n    await loadJs('https://unpkg.com/vue@2.6.11/dist/vue.min.js')\n    appendCss(${JSON.stringify(vueStyle)})\n\n    let module = { exports: null }\n    ;(() => {\n      ;;${vueScript};;\n    })()\n    let App = module.exports\n    App.template = ${JSON.stringify(vueTemplate)}\n\n    if (!mountNode.children[0]) {\n      let innerNode = document.createElement('div')\n      mountNode.appendChild(innerNode)\n    }\n    let curr = mountNode.children[0]\n    new Vue(App).$mount(curr)\n    {\n      let a0 = assetsNodeOutdated\n      a0.parentNode.removeChild(a0)\n    }\n  } catch (err) {\n    console.error(['displayError', err])\n    displayError(err)\n  } finally {\n    removeLoading()\n  }\n})()\n  `.trim();\n};\n\nexport let wrapMd = (code: string) => {\n  return `\n(async () => {\n  let removeLoading = addLoading()\n  {\n    let a0 = assetsNode\n    a0.id = 'assetsNodeOutdated'\n    let a1 = document.createElement('div')\n    a1.id = 'assetsNode'\n    a0.parentNode.appendChild(a1)\n  }\n\n  ReactDOM.unmountComponentAtNode(mountNode)\n  mountNode.innerHTML = '' // put behind, otherwise can cause error in react\n\n  try {\n    await loadJs('https://unpkg.com/vditor@3.2.0/dist/method.min.js')\n    await loadCss('https://unpkg.com/vditor@3.2.0/dist/index.css')\n\n    appendCss(\\`\n    #mdPreview { padding: 16px 16px 32px }\n    #mdPreview > *:first-child { margin-top: 0 !important }\n    .vditor-speech { left: 2px !important }\n    \\`)\n\n    appendHtml(\\`\n    <div id=\"mdPreview\"></div>\n    \\`)\n\n    // Code from https://markdown.lovejade.cn/\n    // let onloadCallback = oEvent => {}\n\n    // Code from https://github.com/Vanessa219/vditor/blob/master/demo/static-preview.html\n    await Vditor.preview(mdPreview, ${JSON.stringify(code)}, {\n      markdown: { toc: true },\n      speech: { enable: true },\n      anchor: true,\n      // after () {\n      //   Vditor.outlineRender(mdPreview, document.getElementById('outline'))\n      // },\n      lazyLoadImage: 'https://cdn.jsdelivr.net/npm/vditor/dist/images/img-loading.svg',\n      renderers: {\n        renderHeading: (node, entering) => {\n          if (entering) {\n            const id = Lute.GetHeadingID(node)\n            return [\n              \\`<h\\${node.__internal_object__.HeadingLevel} class=\"vditor__heading\">\n<a id=\"vditorAnchor-\\${id}\" class=\"vditor-anchor\" href=\"javascript:void 0\"></a>\n<span class=\"prefix\"></span><span>\\`,\n              Lute.WalkContinue]\n          } else {\n            return [\\`</span></h\\${\n              node.__internal_object__.HeadingLevel\n            }>\\`, Lute.WalkContinue]\n          }\n        },\n      },\n    })\n\n    {\n      let a0 = assetsNodeOutdated\n      a0.parentNode.removeChild(a0)\n    }\n  } catch (err) {\n    console.error(['displayError', err])\n    displayError(err)\n  } finally {\n    removeLoading()\n  }\n})()\n  `.trim();\n};\n\nexport let wrapPy = (code: string) => {\n  return `\n(async () => {\n  let removeLoading = addLoading()\n  {\n    let a0 = assetsNode\n    a0.id = 'assetsNodeOutdated'\n    let a1 = document.createElement('div')\n    a1.id = 'assetsNode'\n    a0.parentNode.appendChild(a1)\n  }\n\n  ReactDOM.unmountComponentAtNode(mountNode)\n  mountNode.innerHTML = '' // put behind, otherwise can cause error in react\n\n  try {\n    // await loadJs('http://www.skulpt.org/js/skulpt.min.js')\n    // await loadJs('http://www.skulpt.org/js/skulpt-stdlib.js')\n    await loadJs('./skulpt.min.js')\n    await loadJs('./skulpt-stdlib.js')\n\n    appendCss(\\`\n    #py-container { padding: 20px }\n    #py-canvas { transform: scale(0.7); transform-origin: top center; }\n    \\`)\n\n    let outf = (text) => {\n      let mypre = document.getElementById(\"py-output\");\n      mypre.innerHTML = mypre.innerHTML + text;\n    }\n    let builtinRead = (x) => {\n      if (Sk.builtinFiles === undefined || Sk.builtinFiles[\"files\"][x] === undefined)\n        throw \"File not found: '\" + x + \"'\";\n      return Sk.builtinFiles[\"files\"][x];\n    }\n\n    setTimeout(() => {\n      let prog = ${JSON.stringify(code)};\n      Sk.pre = \"py-output\";\n      Sk.configure({ output: outf, read: builtinRead });\n\n      (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'py-canvas';\n      let myPromise = Sk.misceval.asyncToPromise(function() {\n        return Sk.importMainWithBody(\"<stdin>\", false, prog, true);\n      });\n      myPromise.then(function(mod) {\n        console.log('success');\n      }, function(err) {\n        console.error(['displayError', err])\n        displayError(String(err))\n      });\n    }, 0)\n\n    let h = React.createElement\n    ReactDOM.render(h('div', { id: 'py-container' }, [\n      h('pre', { key: 1, id: 'py-output' }),\n      h('div', { key: 2, id: 'py-canvas' }),\n    ]), mountNode)\n    {\n      let a0 = assetsNodeOutdated\n      a0.parentNode.removeChild(a0)\n    }\n  } catch (err) {\n    console.error(['displayError', err])\n    displayError(err)\n  } finally {\n    removeLoading()\n  }\n})()\n  `.trim();\n};\n\nexport let wrapJs = (code: string) => {\n  return `\n(async () => {\n  let removeLoading = addLoading()\n  {\n    let a0 = assetsNode\n    a0.id = 'assetsNodeOutdated'\n    let a1 = document.createElement('div')\n    a1.id = 'assetsNode'\n    a0.parentNode.appendChild(a1)\n  }\n\n  ReactDOM.unmountComponentAtNode(mountNode)\n  mountNode.innerHTML = '' // put behind, otherwise can cause error in react\n\n  try {\n    let { useRef, useMemo, useState, useEffect, useLayoutEffect, useReducer, useContext, useCallback, useImperativeHandle } = React\n\n    ;;${code};;\n\n    if (typeof App !== 'undefined') {\n      let isVueLike = _.isPlainObject(App)\n      if (isVueLike) {\n        if (!mountNode.children[0]) {\n          let innerNode = document.createElement('div')\n          mountNode.appendChild(innerNode)\n        }\n        let curr = mountNode.children[0]\n        new Vue(App).$mount(curr)\n      } else {\n        ReactDOM.render(React.createElement(App), mountNode)\n      }\n    }\n    {\n      let a0 = assetsNodeOutdated\n      a0.parentNode.removeChild(a0)\n    }\n  } catch (err) {\n    console.error(['displayError', err])\n    displayError(err)\n  } finally {\n    removeLoading()\n  }\n})()\n  `.trim();\n};\n","import { Col, Row } from 'antd';\nimport styled from 'styled-components';\nimport media from 'styled-media-query';\n\n/**\n * https://github.com/morajabi/styled-media-query\n * export const defaultBreakpoints = {\n    huge: '1440px',\n    large: '1170px',\n    medium: '768px',\n    small: '450px',\n  };\n */\n\nexport let MainRow = styled(Row)`\n  height: 100%;\n  display: flex;\n\n  ${media.lessThan('medium')`\n    flex-direction: column;\n  `}\n`;\n\nexport let MainCol = styled(Col)`\n  height: 100%;\n`;\n\nexport let MountNode = styled.div`\n  height: 100%;\n  min-height: 100px;\n  overflow-y: auto;\n  word-break: break-word;\n`;\n\nexport let ErrorInfo = styled.pre`\n  font-size: 12px;\n  color: red;\n  white-space: pre-wrap;\n  padding: 10px;\n`;\n","import Axios from 'axios';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ErrorInfo } from './styled';\n\nexport let displayError = (err: Error) => {\n  let mountNode = document.querySelector('#mountNode');\n  ReactDOM.render(<ErrorInfo>{err.stack}</ErrorInfo>, mountNode);\n};\n\nexport let loadJsForceUmd = async ({\n  url,\n  name,\n  deps = {},\n}: {\n  url: string;\n  name: string;\n  deps: { [key: string]: string };\n}) => {\n  let code = '';\n  try {\n    let { data } = await Axios(url);\n    code = data;\n  } catch (err) {\n    throw new Error(`loadJsForceUmd - ${err.message} - ${url}`);\n  }\n  code = `\n    (() => {\n      let module = { exports: {} }\n      let require = k => {\n        ${Object.keys(deps)\n          .map(k => `if (k === ${JSON.stringify(k)}) return ${deps[k]}`)\n          .join('\\n')}\n        throw new Error(\\`module '\\${k}' not found\\`)\n      }\n      ;;${code};;\n      window[${JSON.stringify(name)}] = module.exports\n    })()\n  `;\n  appendJs(code);\n};\n\nexport let loadJs = (url: string | string[]): Promise<void> => {\n  if (Array.isArray(url)) {\n    return Promise.all(url.map(loadJs)).then(() => undefined);\n  }\n  return new Promise((resolve, reject) => {\n    let el = document.createElement('script');\n    el.src = url;\n    el.onload = () => {\n      resolve();\n    };\n    el.onerror = e => {\n      reject(new Error(`loadJs onerror - ${url}`));\n    };\n    window.assetsNode.appendChild(el);\n  });\n};\n\nexport let loadCss = (url: string | string[]): Promise<void> => {\n  if (Array.isArray(url)) {\n    return Promise.all(url.map(loadCss)).then(() => undefined);\n  }\n  return new Promise((resolve, reject) => {\n    let el = document.createElement('link');\n    el.rel = 'stylesheet';\n    el.href = url;\n    el.onload = () => {\n      resolve();\n    };\n    el.onerror = e => {\n      reject(new Error(`loadCss onerror - ${url}`));\n    };\n    window.assetsNode.appendChild(el);\n  });\n};\n\n// todo error-handling\nexport let appendJs = (code: string) => {\n  let el = document.createElement('script');\n  el.innerHTML = code;\n  window.assetsNode.appendChild(el);\n};\n\nexport let appendCss = (code: string) => {\n  let el = document.createElement('style');\n  el.innerHTML = code;\n  window.assetsNode.appendChild(el);\n};\n\nexport let appendHtml = (code: string) => {\n  window.mountNode.innerHTML += code;\n};\n","import * as Antd from 'antd';\nimport Axios from 'axios';\nimport 'codemirror/lib/codemirror.css';\n// import 'codemirror/mode/javascript/javascript';\nimport 'codemirror/mode/jsx/jsx';\nimport 'codemirror/mode/markdown/markdown';\nimport 'codemirror/mode/python/python';\nimport 'codemirror/mode/vue/vue';\nimport 'codemirror/theme/material.css';\nimport immer from 'immer';\nimport _ from 'lodash';\nimport moment from 'moment';\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { Controlled as CodeMirror } from 'react-codemirror2';\nimport ReactDOM from 'react-dom';\nimport { DragSizing } from 'react-drag-sizing';\nimport Helmet from 'react-helmet';\nimport { useHistory, useParams } from 'react-router';\nimport styled from 'styled-components';\nimport useMedia from 'use-media';\nimport { GentleSpin } from '../components/GentleSpin';\nimport { useApi } from '../hooks/useApi';\nimport { useFormBinding } from '../hooks/useFormBinding';\nimport { useInterval } from '../hooks/useInterval';\nimport { useModel } from '../hooks/useModel';\nimport { useTrigger } from '../hooks/useTrigger';\nimport { codeTransform } from './codeTransform';\nimport './page.css';\nimport './print.css';\nimport { MainCol, MainRow, MountNode } from './styled';\nimport {\n  appendCss,\n  appendHtml,\n  appendJs,\n  displayError,\n  loadCss,\n  loadJs,\n  loadJsForceUmd,\n} from './util';\n\nObject.assign(window, {\n  useFormBinding,\n  useInterval,\n  useModel,\n  moment,\n  styled,\n  immer,\n  _,\n  axios: Axios,\n  Antd,\n  React,\n  ReactDOM,\n  displayError,\n  loadJsForceUmd,\n  loadJs,\n  loadCss,\n  appendJs,\n  appendCss,\n  appendHtml,\n  setRendering: _.noop, // noop placeholder\n});\n\n// let storeKeyCode = 'playground__initialCode';\n\nexport let Playground: React.FC = () => {\n  let history = useHistory();\n  let { file } = useParams() as { file: string };\n  file = file || '';\n\n  let isVue = file.endsWith('.vue');\n  let isPy = file.endsWith('.py');\n  let isMd = file.endsWith('.md');\n\n  // let initialCode = useMemo(() => {\n  //   return localStorage.getItem(storeKeyCode) || _initialCode;\n  // }, []);\n  let initialCode = '';\n  let codeBinding = useFormBinding(initialCode, (editor, data, value) => value);\n\n  let {\n    request: reqCode,\n    error: errReqCode,\n    response: respCode,\n    loading: loadingCode,\n  } = useApi<string>('GET', 'code/:file');\n\n  useEffect(() => {\n    if (file) {\n      reqCode({ pathParams: { file } });\n    } else {\n      history.push('/');\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [file]);\n\n  useEffect(() => {\n    if (respCode == null) return;\n    codeBinding.controlled.onChange(null, null, respCode.data);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [respCode]);\n\n  useEffect(() => {\n    // if (errReqCode && String(errReqCode).includes('status code 404')) {\n    //   history.push('/'); // force redirect\n    // }\n    if (errReqCode) {\n      displayError(new Error(`${errReqCode.message} - ${file}`));\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [errReqCode]);\n\n  let [preview, setPreview] = useState('');\n  let [compiling, setCompiling] = useState(false);\n  let [rendering, _setRendering] = useState(0);\n  let previewLoading = loadingCode || compiling || rendering > 0;\n\n  let addLoading = useCallback(() => {\n    _setRendering(s => s + 1);\n    return () => _setRendering(s => s - 1);\n  }, []);\n\n  Object.assign(window, { addLoading }); // without side-effect\n\n  let doPreview = useCallback(\n    async (code: string) => {\n      if (!code) return;\n      setCompiling(true);\n      try {\n        let res = await codeTransform(code, file);\n        // console.log('res', res);\n        setPreview(res);\n      } catch (err) {\n        displayError(err);\n      } finally {\n        setCompiling(false);\n      }\n    },\n    [file]\n  );\n\n  // let persistEditor = useCallback((code: string) => {\n  //   localStorage.setItem(storeKeyCode, code);\n  // }, []);\n\n  useTrigger(\n    {\n      debounce: 1000,\n      // initial: true,\n      cancel: true,\n      singleton: true,\n    },\n    doPreview,\n    [codeBinding.value]\n  );\n  window.triggerPreview = () => {\n    // doPreview(codeBinding.value);\n    doPreview(codeBinding.value + `\\n\\n/* ${new Date()} */`);\n  };\n\n  // useTrigger(\n  //   {\n  //     throttle: 1000,\n  //   },\n  //   persistEditor,\n  //   [codeBinding.value]\n  // );\n\n  // keeping sync'd with styled.ts (medium=768px)\n  let isGreaterThanMedium = useMedia({ minWidth: '768px' });\n\n  let handleSizingUpdate = useCallback(() => {\n    let event = new Event('resize');\n    window.mountNode.dispatchEvent(event);\n  }, []);\n\n  useEffect(() => {\n    window.addEventListener('resize', handleSizingUpdate);\n    return () => {\n      window.removeEventListener('resize', handleSizingUpdate);\n    };\n  }, [handleSizingUpdate]);\n\n  return (\n    <div className=\"page-playground\">\n      <Helmet>\n        <title>Playground{file ? ` - ${file}` : ''}</title>\n        <style>{`html { overflow: hidden } #root { height: 100% }`}</style>\n        <script>{preview}</script>\n      </Helmet>\n      <MainRow>\n        <MainCol style={{ flex: 1, overflowX: 'auto' }}>\n          <GentleSpin spinning={previewLoading}>\n            <MountNode id=\"mountNode\" />\n            <div id=\"assetsNode\" />\n          </GentleSpin>\n        </MainCol>\n        <DragSizing\n          className=\"editor-area\"\n          onUpdate={handleSizingUpdate}\n          {...(isGreaterThanMedium\n            ? {\n                border: 'left',\n                style: {\n                  minWidth: '20%',\n                  maxWidth: '80%',\n                  width: '50%',\n                },\n              }\n            : {\n                border: 'top',\n                style: {\n                  minHeight: '20%',\n                  maxHeight: '80%',\n                  height: '50%',\n                },\n              })}\n        >\n          <MainCol>\n            <CodeMirror\n              className=\"main-editor\"\n              options={{\n                mode: isMd\n                  ? 'markdown'\n                  : isVue\n                  ? 'vue'\n                  : isPy\n                  ? 'python'\n                  : 'text/typescript-jsx',\n                theme: 'material',\n                lineNumbers: true,\n              }}\n              value={codeBinding.controlled.value}\n              onBeforeChange={codeBinding.controlled.onChange}\n            />\n          </MainCol>\n        </DragSizing>\n      </MainRow>\n    </div>\n  );\n};\n","import { useEffect } from 'react';\n\ntype AnyFunc = (...args: any) => any;\n\nexport let useInterval = (func: AnyFunc, interval: number) => {\n  useEffect(() => {\n    let id = setInterval(() => {\n      func();\n    }, interval);\n    return () => {\n      if (id) clearInterval(id);\n    };\n  }, [func, interval]);\n};\n","import _ from 'lodash';\nimport { Reducer, useMemo, useReducer } from 'react';\n\ninterface ActionArgMap<A> {\n  [type: string]: (...args: any[]) => Omit<A, 'type'> | null;\n}\ninterface ActionMap<A> {\n  [type: string]: (...args: any[]) => A;\n}\n\nexport let useModel = <S, A extends { type: string }>(\n  reducer: Reducer<S, A>,\n  initialState: S,\n  _actions: ActionArgMap<A>\n) => {\n  let [state, dispatch] = useReducer<Reducer<S, A>>(reducer, initialState);\n\n  let actions = useMemo<ActionMap<A>>(() => {\n    return _.reduce(\n      _actions,\n      (acc, func, k) => {\n        acc[k] = (...args: any[]) => {\n          let patch = func(...args);\n          let action = { type: k, ...patch } as A;\n          return dispatch(action);\n        };\n        return acc;\n      },\n      Object.create(null)\n    );\n  }, [_actions, dispatch]);\n\n  return [state, actions];\n};\n","import _ from 'lodash';\nimport { useEffect, useMemo } from 'react';\n\ntype AnyFunc = (...args: any) => any;\n\ninterface Options {\n  debounce?: number;\n  throttle?: number;\n  options?: _.DebounceSettings | _.ThrottleSettings;\n  initial?: boolean;\n  cancel?: boolean;\n  singleton?: boolean;\n}\n\nexport let useTrigger = (options: Options, _func: AnyFunc, deps: any[]) => {\n  options = options || {};\n\n  let func: AnyFunc | (AnyFunc & _.Cancelable) = useMemo(() => {\n    if (options.debounce) {\n      return _.debounce(_func, options.debounce, options.options);\n    } else if (options.throttle) {\n      return _.throttle(_func, options.throttle, options.options);\n    } else {\n      return _func;\n    }\n  }, [_func, options.debounce, options.options, options.throttle]);\n\n  useEffect(() => {\n    if (options.singleton) {\n      if ('cancel' in func) func.cancel();\n    }\n    func(...deps);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, deps);\n\n  useEffect(() => {\n    if (options.initial) {\n      if ('cancel' in func) func.cancel();\n      _func(...deps);\n    }\n    return () => {\n      if (options.cancel) {\n        if ('cancel' in func) func.cancel();\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n};\n"],"sourceRoot":""}